{# templates/panier/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Mon Panier{% endblock %}
{% block main_banner %}{% endblock %}
{% block body %}
<div class="container py-4">
  <h2 class="mb-4 text-center">Mon panier</h2>

  {% if panier.articles is empty %}
    <div class="alert alert-info text-center">
      Votre panier est vide.
      <div class="mt-2">
        <a href="{{ path('app_home') }}" class="btn btn-dark btn-sm">Continuer mes achats</a>
      </div>
    </div>
  {% else %}

    {# Liste des articles #}
    <div class="row g-3">
      <div class="col-lg-8">
        {% for article in panier.articles %}
          {% set montre = article.montre %}
          <div class="p-3 rounded-3 border bg-light">
            <div class="row align-items-center g-2">
              <div style="display: flex; gap: 10px; margin-top: 10px; justify-content: center;">
					{% if montre.image %}
						<img src="{{ asset('images/photos_montres/' ~ montre.image) }}" alt="Photo 1" class="mini" width="70" style="border-radius: 4px; cursor: pointer;">
					{% endif %}
					{% if montre.image2 %}
						<img src="{{ asset('images/photos_montres/' ~ montre.image2) }}" alt="Photo 2" class="mini" width="70" style="border-radius: 4px; cursor: pointer;">
					{% endif %}
					{% if montre.image3 %}
						<img src="{{ asset('images/photos_montres/' ~ montre.image3) }}" alt="Photo 3" class="mini" width="70" style="border-radius: 4px; cursor: pointer;">
					{% endif %}

				</div>
              <div class="col-9 col-md-6">
                <h5 class="mb-1">{{ montre.marque }}</h5>
                <div class="text-muted small">

                {#Si la montre a une marque affiche son nom  Si Non affiche "Marque inconnue"#}
                  {{ montre.marque is defined and montre.marque ? montre.marque.nom : 'Marque inconnue' }}
                  
                </div>
                <div class="small">Réf. #{{ montre.id }}</div>
              </div>
              <div class="col-12 col-md-4">
                <div class="d-flex flex-column align-items-end">
                  <div class="d-flex align-items-center mb-2">
                    <a class="btn btn-outline-secondary btn-sm" href="{{ path('panier_diminuer', {id: montre.id}) }}" aria-label="Diminuer">-</a>
                    <input type="text" class="form-control form-control-sm text-center mx-2" value="{{ article.quantite }}" readonly style="width:56px">
                    <a class="btn btn-outline-secondary btn-sm" href="{{ path('panier_ajouter', {id: montre.id}) }}" aria-label="Augmenter">+</a>
                  </div>
                  <div class="fw-semibold">Prix : {{ montre.prix|number_format(2, ',', ' ') }} €</div>
                  <div class="small text-muted">Ligne : {{ (montre.prix * article.quantite)|number_format(2, ',', ' ') }} €</div>
                  <a class="btn btn-danger btn-sm mt-2" href="{{ path('panier_supprimer', {id: montre.id}) }}">Supprimer</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {# Résumé commande #}
      <div class="col-lg-4">
        <div class="p-3 rounded-3 border bg-light sticky-top" style="top: 1rem;">
          <h5 class="mb-3">Résumé</h5>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between">
              <span>Sous-total</span>
              <strong>{{ panier.sous_total|number_format(2, ',', ' ') }} €</strong>
            </li>
            
            <li class="list-group-item d-flex justify-content-between">
              <span>Total</span>
              <strong>{{ panier.total|default(panier.sous_total)|number_format(2, ',', ' ') }} €</strong>
            </li>
          </ul>
          <a href="{{ path('app_home') }}" class="btn btn-link w-100 mt-2">Continuer mes achats</a>
        </div>
      </div>
    </div>

  {% endif %}
</div>
{% endblock %}
