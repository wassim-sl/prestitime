{% extends 'base.html.twig' %}

{% block title %}Résultats de recherche
{% endblock %}
{% block main_banner %}{% endblock %}

{% block body %}
	<div style="max-width: 1400px; margin: auto; padding: 20px; margin-top:20px; background:rgba(246, 216, 186, 0.63); " class="card " ;>

		<h1 class="text-center " style="color:  rgba(214, 161, 108, 0.86);">
			<strong>
				Résultats pour :
				<strong/>
				"{{ query }}"
			</h1><br>

			{# Cas 1 : aucune recherche saisie  #}
			{% if query is empty %}
				<div class="alert alert-info text-center">
					Tapez un mot-clé dans la barre de recherche pour trouver une montre.
				</div>
			{% endif %}

			{# Cas 2 : aucune montre trouvée #}
			{% if montres is empty and query is not empty %}
				<div class="alert alert-warning">Aucune montre trouvée pour "{{ query }}".</div>
			{% endif %}

			{# Cas 3 : résultats #}
			{% if montres is not empty %}
				<div class="row">
					{% for montre in montres %}
						<div class="col-md-4 mb-4">
							<div
								class="card h-100 shadow-sm" style="background: rgba(255, 241, 241, 0.9);">
								{# Image principale si disponible, sinon un placeholder #}
								{% if montre.image %}
									<img src="{{ asset('images/photos_montres/' ~ montre.image) }}" class="card-img-top" alt="{{ (montre.marque ~ ' ' ~ (montre.categorie ?? ''))|trim }}" style="object-fit: contain; max-height: 220px;">
								{% else %}
									<div class="d-flex align-items-center justify-content-center bg-light" style="height:220px;">
										<span class="text-muted">Aucune image</span>
									</div>
								{% endif %}

								<div
									class="card-body d-flex flex-column">
									{# Marque - Catégorie #}
									<h5 class="card-title mb-1">
										{{ montre.marque }}
										{% if montre.categorie %}
											<small class="text-muted">—
												{{ montre.categorie }}</small>
										{% endif %}
									</h5>

									{# Disponibilité  #}
									<p class="mb-2">
										<strong>Disponibilité :</strong>
										{% if montre.isActive %}
											<span class="text-success">✅ Disponible</span>
										{% else %}
											<span class="text-danger">❌ Indisponible</span>
										{% endif %}
									</p>

									{# Description courte #}
									{% if montre.description %}
										<p class="mb-2">{{ montre.description|slice(0, 110) }}
											{% if montre.description|length > 110 %}…
											{% endif %}
										</p>
									{% endif %}

									{# Prix formaté #}
									<p class="fw-bold mb-3 ">{{ montre.prix|number_format(2, ',', ' ') }}
										€</p>

									{# Miniatures si image2 / image3  #}
									{% if montre.image2 or montre.image3 %}
										<div class="d-flex gap-2 mb-3 justify-content-start">
											{% if montre.image %}
												<img src="{{ asset('images/photos_montres/' ~ montre.image) }}" alt="Photo 1" width="48" height="48" style="object-fit: cover; border-radius: 4px;">
											{% endif %}
											{% if montre.image2 %}
												<img src="{{ asset('images/photos_montres/' ~ montre.image2) }}" alt="Photo 2" width="48" height="48" style="object-fit: cover; border-radius: 4px;">
											{% endif %}
											{% if montre.image3 %}
												<img src="{{ asset('images/photos_montres/' ~ montre.image3) }}" alt="Photo 3" width="48" height="48" style="object-fit: cover; border-radius: 4px;">
											{% endif %}
										</div>
									{% endif %}

									{# Actions #}
									<div class="mt-auto d-flex gap-2">
										<a href="{{ path('app_montre_show', { id: montre.id }) }}" class="btn" style="background-color: rgba(214, 161, 108, 0.86); color: white; border: none;">
											Voir la fiche
										</a>


										{% if montre.isActive %}
											{% if is_granted('ROLE_USER') and not is_granted('ROLE_ADMIN') %}
												<a href="{{ path('panier_ajouter', { id: montre.id }) }}" class="btn btn-secondary">
													Ajouter au panier
												</a>
											{% endif %}
										{% else %}
											<button class="btn btn-secondary" disabled title="Indisponible">
												Ajouter au panier
											</button>
										{% endif %}
									</div>
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
			{% endif %}

			{# Lien retour  #}
			<div class="mt-3">
				<a href="{{ path('app_home') }}" class="btn btn-outline-secondary">
					Retour
				</a>
			</div>
		</div>
	{% endblock %}
